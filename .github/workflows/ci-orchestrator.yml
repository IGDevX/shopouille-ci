name: CI Orchestrator

on:
  repository_dispatch:
    types: [ci-trigger]

jobs:
  dispatch:
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.extract.outputs.branch }}
    steps:
      - name: Extract branch from payload
        id: extract
        run: |
          echo "branch=${{ github.event.client_payload.branch }}" >> $GITHUB_OUTPUT

  feature_hotfix:
    if: startsWith(needs.dispatch.outputs.branch, 'feature/') || startsWith(needs.dispatch.outputs.branch, 'hotfix/')
    uses: ./.github/workflows/feature-hotfix.yml

  develop_pr:
    if: needs.dispatch.outputs.branch == 'develop'
    uses: ./.github/workflows/develop-pr.yml

  staging_pr:
    if: needs.dispatch.outputs.branch == 'staging'
    uses: ./.github/workflows/staging-pr.yml

  main_pr:
    if: needs.dispatch.outputs.branch == 'main'
    uses: ./.github/workflows/main-pr.yml
